<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        I-CH 183 - 1. Authentification - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{display:block;background:#fff;padding:.5em;color:#333;overflow-x:auto}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.markdown-body{font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e7e7e7;border:0}.markdown-body blockquote{font-size:16px;padding:0 1em;color:#777;border-left:.25em solid #ddd}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid #ccc;border-bottom-color:#bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#777}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{padding:0;list-style-type:none}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:transparent}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #ddd}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#333}.markdown-body span.align-center{display:block;overflow:hidden;clear:both}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{display:block;overflow:hidden;clear:both}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{padding:0;padding-top:.2em;padding-bottom:.2em;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{letter-spacing:-.2em;content:"\00a0"}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}.markdown-body pre code,.markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{font-weight:700;background:#f8f8f8;border-top:0}.news .alert .markdown-body blockquote{padding:0 0 0 40px;border:0 none}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle;cursor:default!important}.markdown-body{padding-top:40px;padding-bottom:40px;max-width:758px;overflow:visible!important;position:relative}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{text-align:right;position:relative;display:inline-block;cursor:default;z-index:4;padding:0 8px 0 0;min-width:20px;box-sizing:content-box;color:#afafaf!important;border-right:3px solid #6ce26c!important}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-left:none;border-top:none;border-bottom:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-spacing:0;border-collapse:inherit!important}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{overflow:unset;margin-bottom:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p:last-child{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{text-align:center;background-color:inherit;border-radius:0;white-space:inherit;overflow:visible}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{max-width:100%;height:100%}.markdown-body pre>code.wrap{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}.markdown-body .alert>p:last-child,.markdown-body .alert>ul:last-child{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{cursor:pointer;display:table;text-align:center;background-position:50%;background-repeat:no-repeat;background-size:contain;background-color:#000;overflow:hidden}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{width:100%;object-fit:contain;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{width:100%;height:100%;position:absolute;top:0;left:0}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{position:absolute;height:auto;width:auto;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;opacity:.3;transition:opacity .2s;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%}.figma{display:table;position:relative;width:100%;padding-bottom:56.25%}.figma iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;border:1px solid #eee}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{position:relative;z-index:2;max-width:760px;margin:25px auto -25px;color:#777}.toc .invisable-node{list-style-type:none}.ui-toc{position:fixed;bottom:20px;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{height:40px;padding:10px 4px;border-top-left-radius:0;border-bottom-left-radius:0}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{opacity:1;color:#fff;transition:opacity .2s}.ui-toc-label:focus{opacity:.3;background-color:#ccc;color:#000}.ui-toc-label:hover{opacity:1;background-color:#ccc;transition:opacity .2s}.ui-toc-dropdown{margin-top:20px;margin-bottom:20px;padding-left:10px;padding-right:10px;max-width:45vw;width:25vw;max-height:70vh;overflow:auto;text-align:inherit}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{padding-right:0;letter-spacing:.0029em}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{display:block;padding:4px 20px;font-size:13px;font-weight:500;color:#767676}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{padding-left:19px;color:#000;text-decoration:none;background-color:transparent;border-left:1px solid #000}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{padding-right:19px;border-left:none;border-right:1px solid #000}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{padding-left:18px;font-weight:700;color:#000;background-color:transparent;border-left:2px solid #000}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{padding-right:18px;border-left:none;border-right:2px solid #000}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:40px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{padding-left:28px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{padding-left:38px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ\ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ\ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{position:fixed;top:0;max-width:15vw;max-height:70vh;overflow:auto}.back-to-top,.expand-toggle,.go-to-bottom{display:block;padding:4px 10px;margin-top:10px;margin-left:10px;font-size:12px;font-weight:500;color:#999}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{width:20px;height:20px;display:block;border-radius:50%;margin-top:2px;margin-bottom:2px;margin-right:5px;background-position:50%;background-repeat:no-repeat;background-size:cover}.ui-user-icon.small{width:18px;height:18px;display:inline-block;vertical-align:middle;margin:0 0 .2em}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;text-decoration:none;padding-left:22px}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{position:relative;z-index:1;color:#222}.markdown-body.slides:before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background-color:currentColor;box-shadow:0 0 0 50vw}.markdown-body.slides section[data-markdown]{position:relative;margin-bottom:1.5em;background-color:#fff;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{position:absolute;top:50%;left:1em;right:1em;transform:translateY(-50%);max-height:100%;overflow:hidden}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{content:"";position:absolute;top:-1.5em;right:1em;height:1.5em;border:3px solid #777}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;text-shadow:0 0 1em transparent,1px 1px 1.2px rgba(0,0,0,.004);-webkit-overflow-scrolling:touch;letter-spacing:.025em;font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-enabled" data-hard-breaks="true"><style>
.reveal {
  font-size: 27px;
}

mark {
background-color: rgba(50, 168, 82, .5) !important;
}
</style><h1 id="I-CH-183" data-id="I-CH-183"><a class="anchor hidden-xs" href="#I-CH-183" title="I-CH-183"><span class="octicon octicon-link"></span></a><span>I-CH 183</span></h1><p><span>Implémenter la sécurité d’une application</span></p><p><span>1. Authentification</span></p><p><span>© Selmir Hajruli &amp; EPSIC 2022</span></p><hr><h2 id="Introduction" data-id="Introduction"><a class="anchor hidden-xs" href="#Introduction" title="Introduction"><span class="octicon octicon-link"></span></a><span>Introduction</span></h2><ul>
<li><span>.NET 6</span></li>
<li><a href="http://ASP.NET" target="_blank" rel="noopener"><span>ASP.NET</span></a><span> Core Web API</span></li>
<li><a href="http://ASP.NET" target="_blank" rel="noopener"><span>ASP.NET</span></a><span> Core Identity</span></li>
<li><span>EF Core</span></li>
<li><span>JWT</span></li>
</ul><hr><h2 id="Projet-de-départ" data-id="Projet-de-départ"><a class="anchor hidden-xs" href="#Projet-de-départ" title="Projet-de-départ"><span class="octicon octicon-link"></span></a><span>Projet de départ</span></h2><ul>
<li><code>git clone https://github.com/Selmirrrrr/Epsic.Authx.git</code></li>
<li><span>Application de gestion de tests COVID</span></li>
<li><span>Tout le monde </span><mark><span>ressource publique</span></mark>
<ul>
<li><span>Peut voir les stats générales des tests (taux tests négatifs, taux tests positifs, etc)</span></li>
</ul>
</li>
<li><span>Un utilisateur connecté </span><mark><span>authentification</span></mark>
<ul>
<li><span>Peut voir les résultats de ses tests à lui</span></li>
</ul>
</li>
<li><span>Les médecins </span><mark><span>authorization</span></mark>
<ul>
<li><span>Peuvent insérer des résultats de tests</span></li>
<li><span>Voir les résultats pour tous les utilisateurs</span></li>
</ul>
</li>
</ul><hr><h2 id="JWT-Step-by-Step" data-id="JWT-Step-by-Step"><a class="anchor hidden-xs" href="#JWT-Step-by-Step" title="JWT-Step-by-Step"><span class="octicon octicon-link"></span></a><span>JWT Step by Step</span></h2><ul>
<li><code>dotnet add package</code>
<ul>
<li><code>Microsoft.AspNetCore.Authentication.JwtBearer</code></li>
<li><code>Microsoft.AspNetCore.Identity.EntityFrameworkCore</code></li>
</ul>
</li>
<li><span>Ajouter notre clé secréte au fichier </span><code>appsettings.json</code></li>
</ul><pre><code>"JwtConfig": {
    "Secret" : "abcdefghij"
},
</code></pre><div class="alert alert-info">
<p><span>Cette clé secrète va nous servir à signer tokens JWT et ainsi assurer leur intégrité. Cette clé dois absolument rester confidentielle et je JAMAIS transiter vers le client. De plu. la clé doit être composée d’au minimum 32 caractères.</span></p>
</div><ul>
<li><span>Pour finir, l’on crée une classe </span><code>JwtConfig</code><span> pour stocker cette config et l’utiliser dans notre back-end :</span></li>
</ul><pre><code class="csharp hljs"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtConfig</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Secret <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr><h2 id="JWT-Config" data-id="JWT-Config"><a class="anchor hidden-xs" href="#JWT-Config" title="JWT-Config"><span class="octicon octicon-link"></span></a><span>JWT Config</span></h2><ul>
<li><span>Dans notre classe </span><code>Startup.cs</code><span> dans la méthode </span><code>ConfigureServices()</code><span> ajouter la ligne suivante :</span><pre><code class="csharp hljs">services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Configure</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>JwtConfig<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Configuration<span class="token punctuation">.</span><span class="token function">GetSection</span><span class="token punctuation">(</span><span class="token string">"JwtConfig"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<div class="alert alert-info">
<p><span>Ajouter cette ligne va injecter dans le middleware notre configuration JWT.</span></p>
</div>
</li>
</ul><ul>
<li><span>Dans la même méthode ajouter :</span><pre><code class="csharp hljs">services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddIdentity</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IdentityUser<span class="token punctuation">,</span> IdentityRole<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddEntityFrameworkStores</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CovidDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<div class="alert alert-info">
<p><span>Ajouter cette ligne va configurer l’utilisation de </span><a href="http://ASP.NET" target="_blank" rel="noopener"><span>ASP.NET</span></a><span> Core Identity pour la gestion des utilisateurs.</span></p>
</div>
</li>
</ul><hr><h2 id="JWT-Services" data-id="JWT-Services"><a class="anchor hidden-xs" href="#JWT-Services" title="JWT-Services"><span class="octicon octicon-link"></span></a><span>JWT Services</span></h2><ul>
<li><span>Toujours dans la classe </span><code>Startup.cs</code><span> dans la méthode </span><code>ConfigureServices()</code><span> ajouter :</span></li>
</ul><pre><code class="csharp hljs">services<span class="token punctuation">.</span><span class="token function">AddAuthentication</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    options<span class="token punctuation">.</span>DefaultAuthenticateScheme <span class="token operator">=</span> JwtBearerDefaults<span class="token punctuation">.</span>AuthenticationScheme<span class="token punctuation">;</span>
    options<span class="token punctuation">.</span>DefaultChallengeScheme <span class="token operator">=</span> JwtBearerDefaults<span class="token punctuation">.</span>AuthenticationScheme<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">AddJwtBearer</span><span class="token punctuation">(</span>jwt <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> key <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>Configuration<span class="token punctuation">[</span><span class="token string">"JwtConfig:Secret"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    jwt<span class="token punctuation">.</span>SaveToken <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    jwt<span class="token punctuation">.</span>TokenValidationParameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TokenValidationParameters</span>
    <span class="token punctuation">{</span>
        ValidateIssuerSigningKey <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        IssuerSigningKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SymmetricSecurityKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span>
        ValidateIssuer <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        ValidateAudience <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        RequireExpirationTime <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        ValidateLifetime <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="alert alert-info">
<p><span>Ceci va donc configurer l’authentification JWT pour notre service ainsi que paramétrer la validité ou non des tokens reçus.</span></p>
</div><p><span>Note:</span><br>
<span>Ici toute la configuration du JWT Bearer est laissée assez ouverte dans le cadre de l’exercice mais sachez qu’il y a des dizaines de paramètres configurables pour accroitre la sécurité du token, dont les principaux sont :</span></p><ul>
<li><span>ValidateIssuerSigningKey</span>
<ul>
<li><span>Valide que la clé qui a signé le token est bien la clé que nous avons définie.</span></li>
</ul>
</li>
<li><span>IssuerSigningKey = new SymmetricSecurityKey(key)</span>
<ul>
<li><span>Défini le clé de signature du token</span></li>
</ul>
</li>
<li><span>ValidateIssuer = false</span>
<ul>
<li><span>Permet de définir si l’on souhaite valider l’application qui a émis le token, à utiliser en complément avec </span><code>ValidIssuer</code><span>.</span></li>
</ul>
</li>
<li><span>ValidateAudience = false</span>
<ul>
<li><span>La même chose </span><code>ValidAudience</code><span> que mais pour l’audience, à utiliser en complément avec </span><code>ValidIssuer</code><span>.</span></li>
</ul>
</li>
<li><span>RequireExpirationTime = true</span>
<ul>
<li><span>Défini si l’on requiert que le token contienne un claim content sa date d’expiration</span></li>
</ul>
</li>
<li><span>ValidateLifetime = true</span>
<ul>
<li><span>Défini si l’on va valider la date de valider du token, par exemple, si c’est </span><code>false</code><span> que le token est bon mais simplement expiré l’utilisateur sera quand même autorisé à accéder aux ressources. Mauvaise pratique que de ne pas valider le cycle de vie, surtout en cas de vol de token.</span></li>
</ul>
</li>
</ul><p><span>Pour la liste de tous les paramètres dispos voir </span><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.identitymodel.tokens.tokenvalidationparameters?view=azure-dotnet" target="_blank" rel="noopener"><span>ici</span></a><span>.</span></p><hr><h2 id="Authentication-Middleware" data-id="Authentication-Middleware"><a class="anchor hidden-xs" href="#Authentication-Middleware" title="Authentication-Middleware"><span class="octicon octicon-link"></span></a><span>Authentication Middleware</span></h2><ul>
<li><span>Pour terminer notre partie setup, dans la classe </span><code>Startup.cs</code><span> dans la méthode </span><code>Configure()</code><span> avant :</span><pre><code class="csharp hljs">app<span class="token punctuation">.</span><span class="token function">UseAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
<li><span>Ajouter :</span><pre><code class="csharp hljs">app<span class="token punctuation">.</span><span class="token function">UseAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
</ul><hr><h2 id="Identity-database" data-id="Identity-database"><a class="anchor hidden-xs" href="#Identity-database" title="Identity-database"><span class="octicon octicon-link"></span></a><span>Identity database</span></h2><ul>
<li><span>Microsoft </span><a href="http://ASP.NET" target="_blank" rel="noopener"><span>ASP.NET</span></a><span> Core Identity va implémenter pour nous la gestion des users, roles, tokens, etc.</span></li>
<li><span>Pour l’activer il faut, dans notre classe </span><code>CovidDbContext</code><span> hériter de </span><code>IdentityDbContext</code><pre><code class="csharp hljs"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CovidDbContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IdentityDbContext</span></span>
</code></pre>
</li>
<li><span>Puis faire la migration de la base données pour ajouter les tables nécessaires :</span><pre><code>dotnet ef migrations add "Adding authentication"
dotnet ef database update
</code></pre>
</li>
<li><span>Ce qui va nous créer, entre autres, les tables suivantes :</span>
<ul>
<li><span>AspNetRoles</span></li>
<li><span>AspNetUsers</span></li>
<li><span>AspNetUserClaims</span></li>
<li><span>AspNetUserRoles</span></li>
<li><span>AspNetUserTokens</span></li>
</ul>
</li>
</ul><hr><h2 id="AuthController" data-id="AuthController"><a class="anchor hidden-xs" href="#AuthController" title="AuthController"><span class="octicon octicon-link"></span></a><span>AuthController</span></h2><ul>
<li><span>Créer un contrôleur </span><code>AuthController</code><span> :</span></li>
</ul><pre><code class="csharp hljs"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthManagementController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">UserManager<span class="token punctuation">&lt;</span>IdentityUser<span class="token punctuation">&gt;</span></span> _userManager<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">JwtConfig</span> _jwtConfig<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">AuthManagementController</span><span class="token punctuation">(</span><span class="token class-name">UserManager<span class="token punctuation">&lt;</span>IdentityUser<span class="token punctuation">&gt;</span></span> userManager<span class="token punctuation">,</span> <span class="token class-name">IOptionsMonitor<span class="token punctuation">&lt;</span>JwtConfig<span class="token punctuation">&gt;</span></span> optionsMonitor<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _userManager <span class="token operator">=</span> userManager<span class="token punctuation">;</span>
        _jwtConfig <span class="token operator">=</span> optionsMonitor<span class="token punctuation">.</span>CurrentValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="alert alert-info">
<p><span>Ici l’on récupère simplement dans le constructeur une instance de </span><code>UserManager&lt;IdentityUser&gt;</code><span> qui va nous permettre de créer des utilisateurs et de les authentifier. On récupère également notre config JWT configurée précédemment qui nous permettra de signer les tokens avec notre clé personnelle.</span></p>
</div><hr><h2 id="Création-de-compte" data-id="Création-de-compte"><a class="anchor hidden-xs" href="#Création-de-compte" title="Création-de-compte"><span class="octicon octicon-link"></span></a><span>Création de compte</span></h2><ul>
<li><span>Dans ce contrôleur créer une méthode </span><code>Register</code><span> :</span></li>
</ul><pre><code class="csharp hljs"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"auth/Register"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name">RegistrationRequest</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> newUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IdentityUser</span> <span class="token punctuation">{</span>Email <span class="token operator">=</span> user<span class="token punctuation">.</span>Email<span class="token punctuation">,</span> UserName <span class="token operator">=</span> user<span class="token punctuation">.</span>Email<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> isCreated <span class="token operator">=</span> <span class="token keyword">await</span> _userManager<span class="token punctuation">.</span><span class="token function">CreateAsync</span><span class="token punctuation">(</span>newUser<span class="token punctuation">,</span> user<span class="token punctuation">.</span>Password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isCreated<span class="token punctuation">.</span>Succeeded<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> jwtToken <span class="token operator">=</span> <span class="token function">GenerateJwtToken</span><span class="token punctuation">(</span>newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">RegistrationResponse</span>
        <span class="token punctuation">{</span>
            Result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            Token <span class="token operator">=</span> jwtToken
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">RegistrationResponse</span>
    <span class="token punctuation">{</span>
        Result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        Message <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">,</span> isCreated<span class="token punctuation">.</span>Errors<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Description<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="alert alert-info">
<p><span>On crée l’utilisateur via le </span><code>_userManager</code><span>, puis on génère le token JWT dans </span><code>GenerateJwtToken(newUser);</code><span> et on renvoie le résultat.</span></p>
</div><p><span>Note:</span><br>
<span>C’est </span><a href="http://ASP.NET" target="_blank" rel="noopener"><span>ASP.NET</span></a><span> Core Identity, via le </span><code>_userManager</code><span> qui fait tout le boulot pour nous :</span></p><ul>
<li><span>check du mot de passe (respecte les règles de complexité définies)</span></li>
<li><span>hash du mot de passe</span></li>
<li><span>stockage en base de données</span></li>
<li><span>etc</span></li>
</ul><p><span>Tout ce qui nous reste à faire c’est créer le token via </span><code>GenerateJwtToken(newUser);</code></p><hr><h2 id="Création-de-token" data-id="Création-de-token"><a class="anchor hidden-xs" href="#Création-de-token" title="Création-de-token"><span class="octicon octicon-link"></span></a><span>Création de token</span></h2><ul>
<li><span>Dans le même contrôleur implémenter la méthode </span><code>GenerateToken</code><span> permettant de créer le token JWT avant de rennvoyer à l’appelant :</span></li>
</ul><pre><code class="csharp hljs"><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GenerateJwtToken</span><span class="token punctuation">(</span><span class="token class-name">IdentityUser</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> jwtTokenHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtSecurityTokenHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Nous obtenons notre secret à partir des paramètres de l'application.</span>
    <span class="token class-name"><span class="token keyword">var</span></span> key <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>_jwtConfig<span class="token punctuation">.</span>Secret<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Nous devons utiliser les claims qui sont des propriétés de notre token et qui donnent des informations sur le token.</span>
    <span class="token comment">// qui appartiennent à l'utilisateur spécifique à qui il appartient</span>
    <span class="token comment">// donc il peut contenir son id, son nom, son email. L'avantage est que ces informations</span>
    <span class="token comment">// sont générées par notre serveur qui est valide et de confiance.</span>
    <span class="token class-name"><span class="token keyword">var</span></span> tokenDescriptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SecurityTokenDescriptor</span>
    <span class="token punctuation">{</span>
        Subject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ClaimsIdentity</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Claim</span><span class="token punctuation">(</span><span class="token string">"Id"</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Claim</span><span class="token punctuation">(</span>JwtRegisteredClaimNames<span class="token punctuation">.</span>Sub<span class="token punctuation">,</span> user<span class="token punctuation">.</span>Email<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Claim</span><span class="token punctuation">(</span>JwtRegisteredClaimNames<span class="token punctuation">.</span>Email<span class="token punctuation">,</span> user<span class="token punctuation">.</span>Email<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Expires <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">.</span><span class="token function">AddHours</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// ici, nous ajoutons l'information sur l'algorithme de cryptage qui sera utilisé pour décrypter notre token.</span>
        SigningCredentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SigningCredentials</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SymmetricSecurityKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> SecurityAlgorithms<span class="token punctuation">.</span>HmacSha512Signature<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> token <span class="token operator">=</span> jwtTokenHandler<span class="token punctuation">.</span><span class="token function">CreateToken</span><span class="token punctuation">(</span>tokenDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> jwtTokenHandler<span class="token punctuation">.</span><span class="token function">WriteToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><span>Note:</span><br>
<span>Cette méthode va nous générer notre token JWT avec tous les claims associés voulus.</span></p><ul>
<li><span>Id : contient l’id de l’utilisateur</span></li>
<li><span>Sub : contient le sujet du token (username)</span></li>
<li><span>Email : contient le mail de l’utilisateur du token</span></li>
</ul><p><span>Pour finir, on définit la durée de vie du token à 6 heures.</span></p><p><span>Une liste complète des claims “standards” est disponible ici.</span></p><p><span>Sachez également que l’on peut mettre en place ce que l’on veut dans des claims persos mais il faut veiller à respecter certaines règles :</span></p><ul>
<li><span>Jamais d’infos confidentielles dans un token (mot de passe par exemple)</span></li>
<li><span>Garder le token le plus petit possible (il est envoyé à chaque requête)</span></li>
<li><span>Avoir une durée de vie la plus courte possible et utiliser un refresh token pour rafraichir le token JWT de façon transparente pour l’utilisateur.</span></li>
</ul><hr><h2 id="RegistrationRequest" data-id="RegistrationRequest"><a class="anchor hidden-xs" href="#RegistrationRequest" title="RegistrationRequest"><span class="octicon octicon-link"></span></a><span>RegistrationRequest</span></h2><ul>
<li><span>Dans le dossier </span><code>Models</code><span> créer une classe </span><code>RegistrationRequest</code><span> :</span></li>
</ul><pre><code class="csharp hljs"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegistrationRequest</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Password <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr><h2 id="RegistrationResponse" data-id="RegistrationResponse"><a class="anchor hidden-xs" href="#RegistrationResponse" title="RegistrationResponse"><span class="octicon octicon-link"></span></a><span>RegistrationResponse</span></h2><ul>
<li><span>Dans le dossier </span><code>Models</code><span> créer une classe </span><code>RegistrationResponse</code><span> :</span></li>
</ul><pre><code class="csharp hljs"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegistrationResponse</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Token <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> Result <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Message <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr><h2 id="Login" data-id="Login"><a class="anchor hidden-xs" href="#Login" title="Login"><span class="octicon octicon-link"></span></a><span>Login</span></h2><ul>
<li><span>Pour finir, dans ce contrôleur implémenter une méthode </span><code>Login</code><span> :</span></li>
</ul><pre><code class="csharp hljs"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"auth/Login"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">Login</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name">LoginRequest</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Vérifier si l'utilisateur avec le même email existe</span>
    <span class="token class-name"><span class="token keyword">var</span></span> existingUser <span class="token operator">=</span> <span class="token keyword">await</span> _userManager<span class="token punctuation">.</span><span class="token function">FindByEmailAsync</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Email<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>existingUser <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Maintenant, nous devons vérifier si l'utilisateur a entré le bon mot de passe.</span>
        <span class="token class-name"><span class="token keyword">var</span></span> isCorrect <span class="token operator">=</span> <span class="token keyword">await</span> _userManager<span class="token punctuation">.</span><span class="token function">CheckPasswordAsync</span><span class="token punctuation">(</span>existingUser<span class="token punctuation">,</span> user<span class="token punctuation">.</span>Password<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>isCorrect<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> jwtToken <span class="token operator">=</span> <span class="token function">GenerateJwtToken</span><span class="token punctuation">(</span>existingUser<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">RegistrationResponse</span>
            <span class="token punctuation">{</span>
                Result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                Token <span class="token operator">=</span> jwtToken
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Nous ne voulons pas donner trop d'informations sur la raison de l'échec de la demande pour des raisons de sécurité.</span>
    <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">RegistrationResponse</span>
    <span class="token punctuation">{</span>
        Result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        Message <span class="token operator">=</span> <span class="token string">"Invalid authentication request"</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="alert alert-info">
<p><span>Ici c’est le </span><code>_userManager</code><span> de </span><a href="http://ASP.NET" target="_blank" rel="noopener"><span>ASP.NET</span></a><span> Core Identity qui fait une nouvelle fois tout le travail pour nous.</span></p>
</div><hr><h2 id="LoginRequest" data-id="LoginRequest"><a class="anchor hidden-xs" href="#LoginRequest" title="LoginRequest"><span class="octicon octicon-link"></span></a><span>LoginRequest</span></h2><ul>
<li><span>Dans le dossier </span><code>Models</code><span> créer une classe </span><code>LoginRequest</code><span> :</span></li>
</ul><pre><code class="csharp hljs"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginRequest</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Password <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr><h2 id="LoginResponse" data-id="LoginResponse"><a class="anchor hidden-xs" href="#LoginResponse" title="LoginResponse"><span class="octicon octicon-link"></span></a><span>LoginResponse</span></h2><ul>
<li><span>Dans le dossier </span><code>Models</code><span> créer une classe </span><code>LoginResponse</code><span> :</span></li>
</ul><pre><code class="csharp hljs"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginResponse</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Token <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> Result <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Message <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr><h2 id="Authorize" data-id="Authorize"><a class="anchor hidden-xs" href="#Authorize" title="Authorize"><span class="octicon octicon-link"></span></a><span>[Authorize]</span></h2><ul>
<li>
<p><span>Pour terminer, pour protéger un endpoint il suffit maintenant d’ajouter la balise </span><code>[Authorize]</code><span>, par exemple, dans le endpoint </span><code>Create</code><span> dans </span><code>TestsCovidController</code><span> :</span></p>
<pre><code class="csharp hljs"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"testsCovid"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Authorize</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Bind</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"DateTest,Resultat,TypeDeTest"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token class-name">TestCovid</span> testCovid<span class="token punctuation">)</span>
</code></pre>
</li>
<li>
<p><span>Après avoir ajouté cette balise nous avons maintenant un </span><code>401 Error: Unauthorized</code><span> dans Swagger quand on essaye d’ajouter un test, et c’est logique.</span></p>
</li>
</ul><hr><h2 id="Exercices" data-id="Exercices"><a class="anchor hidden-xs" href="#Exercices" title="Exercices"><span class="octicon octicon-link"></span></a><span>Exercices</span></h2><ul>
<li><span>Dans Swagger créer un utilisateur, se connecter, récupérer le token et trouver une moyen de configurer Swagger pour pouvoir faire nos appels avec le token afin de pouvoir de nouveau créer des tests COVID.</span></li>
<li><span>Configurer Microsoft </span><a href="http://ASP.NET" target="_blank" rel="noopener"><span>ASP.NET</span></a><span> Core Identity pour accepter seulement les mot de passes avec les critères suivants :</span>
<ul>
<li><span>Minimum 12 caractères</span></li>
<li><span>Au moins 1 minuscule</span></li>
<li><span>Au moins 1 majuscule</span></li>
<li><span>Minimum 6 caractères différents (AAAAbbbb1234 = ok, AAAAbbbb1111 = ko)</span></li>
</ul>
</li>
<li><span>Ajouter dans notre token JWT un claim perso </span><code>School</code><span> dont la valeur est </span><code>Epsic</code><span>.</span></li>
</ul></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li><a href="#I-CH-183" title="I-CH 183">I-CH 183</a><ul class="nav">
<li><a href="#Introduction" title="Introduction">Introduction</a></li>
<li><a href="#Projet-de-départ" title="Projet de départ">Projet de départ</a></li>
<li><a href="#JWT-Step-by-Step" title="JWT Step by Step">JWT Step by Step</a></li>
<li><a href="#JWT-Config" title="JWT Config">JWT Config</a></li>
<li><a href="#JWT-Services" title="JWT Services">JWT Services</a></li>
<li><a href="#Authentication-Middleware" title="Authentication Middleware">Authentication Middleware</a></li>
<li><a href="#Identity-database" title="Identity database">Identity database</a></li>
<li><a href="#AuthController" title="AuthController">AuthController</a></li>
<li><a href="#Création-de-compte" title="Création de compte">Création de compte</a></li>
<li><a href="#Création-de-token" title="Création de token">Création de token</a></li>
<li><a href="#RegistrationRequest" title="RegistrationRequest">RegistrationRequest</a></li>
<li><a href="#RegistrationResponse" title="RegistrationResponse">RegistrationResponse</a></li>
<li><a href="#Login" title="Login">Login</a></li>
<li><a href="#LoginRequest" title="LoginRequest">LoginRequest</a></li>
<li><a href="#LoginResponse" title="LoginResponse">LoginResponse</a></li>
<li><a href="#Authorize" title="[Authorize]">[Authorize]</a></li>
<li><a href="#Exercices" title="Exercices">Exercices</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        <div class="toc"><ul class="nav">
<li><a href="#I-CH-183" title="I-CH 183">I-CH 183</a><ul class="nav">
<li><a href="#Introduction" title="Introduction">Introduction</a></li>
<li><a href="#Projet-de-départ" title="Projet de départ">Projet de départ</a></li>
<li><a href="#JWT-Step-by-Step" title="JWT Step by Step">JWT Step by Step</a></li>
<li><a href="#JWT-Config" title="JWT Config">JWT Config</a></li>
<li><a href="#JWT-Services" title="JWT Services">JWT Services</a></li>
<li><a href="#Authentication-Middleware" title="Authentication Middleware">Authentication Middleware</a></li>
<li><a href="#Identity-database" title="Identity database">Identity database</a></li>
<li><a href="#AuthController" title="AuthController">AuthController</a></li>
<li><a href="#Création-de-compte" title="Création de compte">Création de compte</a></li>
<li><a href="#Création-de-token" title="Création de token">Création de token</a></li>
<li><a href="#RegistrationRequest" title="RegistrationRequest">RegistrationRequest</a></li>
<li><a href="#RegistrationResponse" title="RegistrationResponse">RegistrationResponse</a></li>
<li><a href="#Login" title="Login">Login</a></li>
<li><a href="#LoginRequest" title="LoginRequest">LoginRequest</a></li>
<li><a href="#LoginResponse" title="LoginResponse">LoginResponse</a></li>
<li><a href="#Authorize" title="[Authorize]">[Authorize]</a></li>
<li><a href="#Exercices" title="Exercices">Exercices</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
