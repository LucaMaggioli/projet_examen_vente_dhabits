<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        I-CH 151 - 5. ORM EF Core - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{display:block;background:#fff;padding:.5em;color:#333;overflow-x:auto}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.markdown-body{font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e7e7e7;border:0}.markdown-body blockquote{font-size:16px;padding:0 1em;color:#777;border-left:.25em solid #ddd}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid #ccc;border-bottom-color:#bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#777}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{padding:0;list-style-type:none}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:transparent}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #ddd}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#333}.markdown-body span.align-center{display:block;overflow:hidden;clear:both}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{display:block;overflow:hidden;clear:both}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{padding:0;padding-top:.2em;padding-bottom:.2em;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{letter-spacing:-.2em;content:"\00a0"}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}.markdown-body pre code,.markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{font-weight:700;background:#f8f8f8;border-top:0}.news .alert .markdown-body blockquote{padding:0 0 0 40px;border:0 none}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle;cursor:default!important}.markdown-body{padding-top:40px;padding-bottom:40px;max-width:758px;overflow:visible!important;position:relative}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{text-align:right;position:relative;display:inline-block;cursor:default;z-index:4;padding:0 8px 0 0;min-width:20px;box-sizing:content-box;color:#afafaf!important;border-right:3px solid #6ce26c!important}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-left:none;border-top:none;border-bottom:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-spacing:0;border-collapse:inherit!important}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{overflow:unset;margin-bottom:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p:last-child{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{text-align:center;background-color:inherit;border-radius:0;white-space:inherit;overflow:visible}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{max-width:100%;height:100%}.markdown-body pre>code.wrap{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}.markdown-body .alert>p:last-child,.markdown-body .alert>ul:last-child{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{cursor:pointer;display:table;text-align:center;background-position:50%;background-repeat:no-repeat;background-size:contain;background-color:#000;overflow:hidden}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{width:100%;object-fit:contain;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{width:100%;height:100%;position:absolute;top:0;left:0}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{position:absolute;height:auto;width:auto;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;opacity:.3;transition:opacity .2s;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%}.figma{display:table;position:relative;width:100%;padding-bottom:56.25%}.figma iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;border:1px solid #eee}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{position:relative;z-index:2;max-width:760px;margin:25px auto -25px;color:#777}.toc .invisable-node{list-style-type:none}.ui-toc{position:fixed;bottom:20px;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{height:40px;padding:10px 4px;border-top-left-radius:0;border-bottom-left-radius:0}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{opacity:1;color:#fff;transition:opacity .2s}.ui-toc-label:focus{opacity:.3;background-color:#ccc;color:#000}.ui-toc-label:hover{opacity:1;background-color:#ccc;transition:opacity .2s}.ui-toc-dropdown{margin-top:20px;margin-bottom:20px;padding-left:10px;padding-right:10px;max-width:45vw;width:25vw;max-height:70vh;overflow:auto;text-align:inherit}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{padding-right:0;letter-spacing:.0029em}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{display:block;padding:4px 20px;font-size:13px;font-weight:500;color:#767676}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{padding-left:19px;color:#000;text-decoration:none;background-color:transparent;border-left:1px solid #000}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{padding-right:19px;border-left:none;border-right:1px solid #000}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{padding-left:18px;font-weight:700;color:#000;background-color:transparent;border-left:2px solid #000}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{padding-right:18px;border-left:none;border-right:2px solid #000}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:40px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{padding-left:28px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{padding-left:38px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ\ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ\ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{position:fixed;top:0;max-width:15vw;max-height:70vh;overflow:auto}.back-to-top,.expand-toggle,.go-to-bottom{display:block;padding:4px 10px;margin-top:10px;margin-left:10px;font-size:12px;font-weight:500;color:#999}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{width:20px;height:20px;display:block;border-radius:50%;margin-top:2px;margin-bottom:2px;margin-right:5px;background-position:50%;background-repeat:no-repeat;background-size:cover}.ui-user-icon.small{width:18px;height:18px;display:inline-block;vertical-align:middle;margin:0 0 .2em}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;text-decoration:none;padding-left:22px}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{position:relative;z-index:1;color:#222}.markdown-body.slides:before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background-color:currentColor;box-shadow:0 0 0 50vw}.markdown-body.slides section[data-markdown]{position:relative;margin-bottom:1.5em;background-color:#fff;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{position:absolute;top:50%;left:1em;right:1em;transform:translateY(-50%);max-height:100%;overflow:hidden}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{content:"";position:absolute;top:-1.5em;right:1em;height:1.5em;border:3px solid #777}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;text-shadow:0 0 1em transparent,1px 1px 1.2px rgba(0,0,0,.004);-webkit-overflow-scrolling:touch;letter-spacing:.025em;font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-enabled" data-hard-breaks="true"><style>
.reveal {
  font-size: 27px;
}

mark {
background-color: rgba(50, 168, 82, .5) !important;
}
</style><h1 id="I-CH-151" data-id="I-CH-151"><a class="anchor hidden-xs" href="#I-CH-151" title="I-CH-151"><span class="octicon octicon-link"></span></a><span>I-CH 151</span></h1><p><span>Intégrer des bases de données dans des applications Web</span></p><p><span>5. ORM EF Core</span></p><p><span>© Selmir Hajruli &amp; EPSIC 2021</span></p><hr><h1 id="Introduction" data-id="Introduction"><a class="anchor hidden-xs" href="#Introduction" title="Introduction"><span class="octicon octicon-link"></span></a><span>Introduction</span></h1><p><span>ORM - Object–relational mapping</span></p><p><img src="https://i.imgur.com/toA6HqC.png" alt="" loading="lazy" width="700"></p><p><span>Note:</span><br>
<span>Que signifie réellement ORM ?</span></p><p><span>Jusqu’à présent, nous avons créé nos </span><code>Character</code><span> en tant que modèles - ou classes - dans notre code. Ces modèles sont constitués de plusieurs propriétés comme un Id, un Name, des HitPoints, etc. En gros, tout cela constitue l’objet.</span></p><p><span>Les bases de données comme SQL Server, SQLite, MySql, MariaDB et bien d’autres sont des bases de données relationnelles et sont constituées de tables pour sauvegarder des données et ces tables peuvent avoir des relations entre elles.</span></p><p><span>C’est exactement la même chose avec nos modèles. Jusqu’à présent, nous n’avons qu’un seul modèle. Mais dès que nous ajouterons des compétences, par exemple, nos </span><code>Character</code><span> pourraient avoir des “skills”  comme lancer des boules de feu en tant que mage.</span></p><p><span>On retrouvera également cette relation dans la base de données. Il y aura une table pour les personnages, une autre pour les compétences et une autre pour la relation entre les personnages et les compétences.</span></p><p><span>Dans le passé, les développeurs devaient établir ces relations manuellement dans la base de données. Avec un ORM comme Entity Framework Core, c’est de l’histoire ancienne. EF Core connaît nos modèles et sait quelles tables doivent être créées. Si les modèles changent, Entity Framework modifie les tables et les relations dans la base de données.</span></p><p><span>Vous construisez d’abord votre code - vos modèles - et ensuite Entity Framework crée la base de données correspondante. (Code first)</span></p><p><span>Il est également possible de construire d’abord les tables de la base de données et de laisser Entity Framework construire les modèles. (Database first)</span></p><hr><h1 id="EF-Core" data-id="EF-Core"><a class="anchor hidden-xs" href="#EF-Core" title="EF-Core"><span class="octicon octicon-link"></span></a><span>EF Core</span></h1><p><span>Entity Framework Core</span></p><ul>
<li><span>Mis en avant par Microsoft, régulièrement mis à jour (actuellement : version 5)</span></li>
<li><span>Bien documenté, bonne communauté</span></li>
<li><span>Parfaitement intégré au reste du framework .NET (validation, exceptions, Linq…)</span></li>
<li><span>Complet tout en restant suffisamment simple d’utilisation</span></li>
<li><span>Alternatives :</span>
<ul>
<li><span>NHibernate</span></li>
<li><span>Dapper</span></li>
<li><span>LLBLGen</span></li>
<li><span>XPO</span></li>
<li><span>etc</span></li>
</ul>
</li>
</ul><hr><h1 id="Code-first-vs-Database-first" data-id="Code-first-vs-Database-first"><a class="anchor hidden-xs" href="#Code-first-vs-Database-first" title="Code-first-vs-Database-first"><span class="octicon octicon-link"></span></a><span>Code first vs Database first</span></h1><ul>
<li><mark><span>Db First</span></mark>
<ul>
<li><span>Comme son nom l’indique, cette méthode implique qu’on a déjà modélisé notre base de données en SQL puis qu’on va générer des classes pour travailler avec ces données. C’est le Modèle Logique de Données qui fera le lien entre la base de données et l’ORM.</span></li>
</ul>
</li>
<li><mark><span>Code first</span></mark>
<ul>
<li><span>Ce qu’un développeur sait faire de mieux, c’est coder.</span></li>
<li><span>On créer nos classes selon le besoin de l’application et ensuite EF Core génère une base données correspondant à notre besoin.</span></li>
</ul>
</li>
</ul><hr><h1 id="Installer-EF-Core" data-id="Installer-EF-Core"><a class="anchor hidden-xs" href="#Installer-EF-Core" title="Installer-EF-Core"><span class="octicon octicon-link"></span></a><span>Installer EF Core</span></h1><ul>
<li><span>Depuis la racine de notre repo </span><code>Epsic.Rpg</code></li>
<li><span>Pour se placer dans le folder de notre projet</span><br>
<code>cd .\src\Epsic.Rpg\</code></li>
<li><span>Pour installer le package nécessaire dans notre projet</span><br>
<code>dotnet add package Microsoft.EntityFrameworkCore.Sqlite --version 3.*</code></li>
<li><span>Pour installer le package nécessaire pour la génération de notre base</span><br>
<code>dotnet add package Microsoft.EntityFrameworkCore.Design --version 3.*</code></li>
<li><span>Pour installer le tooling EF Core sur notre machine</span><br>
<code>dotnet tool install --global dotnet-ef --version 3.*</code></li>
</ul><div class="alert alert-success">
<p><code>dotnet ef</code><span> pour valider l’installation. ✔🚀</span></p>
</div><hr><h1 id="DataContext" data-id="DataContext"><a class="anchor hidden-xs" href="#DataContext" title="DataContext"><span class="octicon octicon-link"></span></a><span>DataContext</span></h1><ul>
<li><span>Pour utiliser EF Core nous avons besoin d’un </span><code>DataContext</code><span>. </span><code>DataContext</code><span> est une classe C# qui va nous permettre de requêter la base de données en créant une connexion à la base et en faisant l’intérmédiaire entre notre programme et notre DB.</span></li>
<li><span>Dans notre projet Epsic.Rpg créer un dossier </span><code>Data</code></li>
<li><span>Dans ce dossier </span><code>Data</code><span> créer une classe </span><code>EpsicRpgDataContext</code><span> qui hérite de </span><code>DbContext</code></li>
<li><span>Dans la classe </span><code>EpsicRpgDataContext</code><span> créer un constrcuteur prennant en paramètre une instance du type </span><code>DbContextOptions&lt;DataContext&gt;</code><span> et le renvoyant au constructeur parent </span><code>: base(options)</code></li>
<li><span>Pour finir, créer une propriété publique de type </span><code>DbSet&lt;Character&gt;</code><span> nommée </span><code>Characters</code><span> avec un </span><code>get</code><span> et </span><code>set</code><span> publics.</span></li>
</ul><hr><h1 id="DataContext1" data-id="DataContext"><a class="anchor hidden-xs" href="#DataContext1" title="DataContext1"><span class="octicon octicon-link"></span></a><span>DataContext</span></h1><pre><code class="csharp hljs"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EpsicRpgDataContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Character<span class="token punctuation">&gt;</span></span> Characters <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">EpsicRpgDataContext</span><span class="token punctuation">(</span><span class="token class-name">DbContextOptions<span class="token punctuation">&lt;</span>EpsicRpgDataContext<span class="token punctuation">&gt;</span></span> options<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
    
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr><h1 id="Setup-amp-Injection" data-id="Setup-amp-Injection"><a class="anchor hidden-xs" href="#Setup-amp-Injection" title="Setup-amp-Injection"><span class="octicon octicon-link"></span></a><span>Setup &amp; Injection</span></h1><ul>
<li><span>Dans le fichier </span><code>Startup.cs</code><span> ajouter, dans la méthode </span><code>ConfigureServices</code><span> :</span></li>
</ul><pre><code class="csharp hljs">services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EpsicRpgDataContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">UseSqlite</span><span class="token punctuation">(</span><span class="token string">@"Data Source=EpsicRpg.db;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><pre><code class="csharp hljs"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token function">AddControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddJsonOptions</span><span class="token punctuation">(</span>jsonOptions <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        jsonOptions<span class="token punctuation">.</span>JsonSerializerOptions<span class="token punctuation">.</span>PropertyNamingPolicy <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EpsicRpgDataContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">UseSqlite</span><span class="token punctuation">(</span><span class="token string">@"Data Source=CustomerDB.db;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    services<span class="token punctuation">.</span><span class="token function">AddSwaggerGen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ICharacterService<span class="token punctuation">,</span> CharacterService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><span>Note:</span></p><ul>
<li><code>.AddDbContext&lt;EpsicRpgDataContext&gt;</code><span> enregistre notre DataContext pour l’injection de dépendances.</span></li>
<li><code>x.UseSqlite(@"Data Source=EpsicRpg.db;")</code><span> indique que l’on souhaite utiliser une base SQLite nommée “EpsicRpg” à la racine de notre projet.</span></li>
</ul><hr><h1 id="Migrations" data-id="Migrations"><a class="anchor hidden-xs" href="#Migrations" title="Migrations"><span class="octicon octicon-link"></span></a><span>Migrations</span></h1><ul>
<li><span>Une “migration” EF Core est une action qui va migrer le schéma de notre base données d’une version à une autre. Par exemple l’ajout d’une nouvelle table se fera via une migration.</span></li>
<li><span>Deux méthodes crées :</span>
<ul>
<li><code>Up()</code><span> utilisée pour passer de la version X à la version X+1</span></li>
<li><code>Down()</code><span> utilisée si besoin de rollback un changement, passage de la version X à la version X-1</span></li>
</ul>
</li>
<li><span>Dans notre cas, nous n’avons pas encore de base données, donc la première migration va générer le code permettant de créer notre base.</span></li>
</ul><hr><h1 id="Première-migration" data-id="Première-migration"><a class="anchor hidden-xs" href="#Première-migration" title="Première-migration"><span class="octicon octicon-link"></span></a><span>Première migration</span></h1><ul>
<li>
<p><span>Toujours dans le projet </span><code>Epsic.Rpg</code><span> éxceuter la commande :</span></p>
</li>
<li>
<p><code>dotnet ef migrations add InitialCreate</code></p>
<p><img src="https://i.imgur.com/Jt2GU8a.png" alt="" loading="lazy"></p>
</li>
<li>
<p><span>Ces fichiers sont utilisés par Entity Framework afin qu’il sache ce qu’il doit faire de cette migration. Ils fournissent des informations sur vos tables et vos champs qu’EF Core utilise pour construire la base de données.</span></p>
</li>
</ul><hr><h1 id="Première-migration1" data-id="Première-migration"><a class="anchor hidden-xs" href="#Première-migration1" title="Première-migration1"><span class="octicon octicon-link"></span></a><span>Première migration</span></h1><h4 id="20201129201557_InitialCreatecs" data-id="20201129201557_InitialCreatecs"><a class="anchor hidden-xs" href="#20201129201557_InitialCreatecs" title="20201129201557_InitialCreatecs"><span class="octicon octicon-link"></span></a><strong><code>20201129201557_InitialCreate.cs</code></strong></h4><pre><code class="csharp hljs"><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Up</span><span class="token punctuation">(</span><span class="token class-name">MigrationBuilder</span> migrationBuilder<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    migrationBuilder<span class="token punctuation">.</span><span class="token function">CreateTable</span><span class="token punctuation">(</span>
     <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">"Characters"</span><span class="token punctuation">,</span>
     <span class="token named-parameter punctuation">columns</span><span class="token punctuation">:</span> table <span class="token operator">=&gt;</span> <span class="token keyword">new</span>
     <span class="token punctuation">{</span>
         Id <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token named-parameter punctuation">nullable</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Annotation</span><span class="token punctuation">(</span><span class="token string">"Sqlite:Autoincrement"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         Name <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token named-parameter punctuation">nullable</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         HitPoints <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token named-parameter punctuation">nullable</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         Strength <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token named-parameter punctuation">nullable</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         Defense <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token named-parameter punctuation">nullable</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         Intelligence <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token named-parameter punctuation">nullable</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         Class <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token named-parameter punctuation">nullable</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token named-parameter punctuation">constraints</span><span class="token punctuation">:</span> table <span class="token operator">=&gt;</span>
     <span class="token punctuation">{</span>
         table<span class="token punctuation">.</span><span class="token function">PrimaryKey</span><span class="token punctuation">(</span><span class="token string">"PK_Characters"</span><span class="token punctuation">,</span> x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre><code class="csharp hljs"><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Down</span><span class="token punctuation">(</span><span class="token class-name">MigrationBuilder</span> migrationBuilder<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    migrationBuilder<span class="token punctuation">.</span><span class="token function">DropTable</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">"Characters"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr><h1 id="Première-DB" data-id="Première-DB"><a class="anchor hidden-xs" href="#Première-DB" title="Première-DB"><span class="octicon octicon-link"></span></a><span>Première DB</span></h1><p><span>Maintenant que l’on a généré le code qui va pouvoir créer notre base de données, on va pouvoir procéder à la création de celle-ci, pour ce faire, il faut simplement éxécuter la commande suivante :</span></p><p><code>dotnet ef database update</code></p><p><img src="https://i.imgur.com/oFoOHyN.png" alt="" loading="lazy" width="400"></p><p><em><span>si tout s’est bien passé, voici notre base de données 🤞🚀</span></em></p><p><span>Note:</span><br>
<span>Pour “voir” notre base données, nous pouvons utiliser une extension VS Code nommée “</span><a href="https://marketplace.visualstudio.com/items?itemName=alexcvzz.vscode-sqlite" target="_blank" rel="noopener"><span>SQLite</span></a><span>”.</span></p><p><span>1.Chercher SQLite dans l’onglet “Extensions” de VS Code</span><br>
<img src="https://i.imgur.com/YjgyhA4.png" alt="" loading="lazy"><br>
<span>2. Cliquer sur installer</span><br>
<span>3. Appuyer sur </span><code>FI</code><span> ou </span><code>CTRL+SHIFT+P</code><span> et taper “sqlite” dans la commande palette :</span><br>
<img src="https://i.imgur.com/yJTfT33.png" alt="" loading="lazy"><br>
<span>4. Sélectionner “Open database”</span><br>
<span>5. Puis sélectionner votre base de données</span><br>
<img src="https://i.imgur.com/kQdT67L.png" alt="" loading="lazy"><br>
<span>6. Vous avez miantenant un onglet “SQLITE EXPLORER” qui est apparu dans votre colonne de gauche, et si vous appyuez dessus normalement vous voyez ça :</span><br>
<img src="https://i.imgur.com/TIw9Zsr.png" alt="" loading="lazy"><br>
<span>7. Un clic droit sur “Characters” + click sur “Show table” affichera le contenu de la table dans une nouvelle fenêtre. (c’est vide c’est normal 👻)</span></p><hr><h1 id="Première-requête" data-id="Première-requête"><a class="anchor hidden-xs" href="#Première-requête" title="Première-requête"><span class="octicon octicon-link"></span></a><span>Première requête</span></h1><ul>
<li><span>Dans votre classe </span><code>CharacterService</code><span> demander une instance de </span><code>EpsicRpgDataContext</code><span> en paramètre.</span><pre><code class="csharp hljs"><span class="token keyword">public</span> <span class="token function">CharacterService</span><span class="token punctuation">(</span><span class="token class-name">EpsicRpgDataContext</span> context<span class="token punctuation">)</span>
</code></pre>
</li>
<li><span>Créer une varaible d’instance de type </span><code>EpsicRpgDataContext</code><span> nommée </span><code>_context</code><pre><code class="csharp hljs"><span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">EpsicRpgDataContext</span> _context<span class="token punctuation">;</span>
</code></pre>
</li>
<li><span>Puis, instancier cette variable </span><code>_context</code><span> avec le </span><code>context</code><span> injecté via le constructeur :</span><pre><code class="csharp hljs">_context <span class="token operator">=</span> context<span class="token punctuation">;</span>
</code></pre>
</li>
<li><span>Pour finir, remplacer le retour de </span><code>GetAll()</code><span> par</span><pre><code class="csharp hljs">_context<span class="token punctuation">.</span>Characters<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
</ul><hr><h1 id="Première-requête1" data-id="Première-requête"><a class="anchor hidden-xs" href="#Première-requête1" title="Première-requête1"><span class="octicon octicon-link"></span></a><span>Première requête</span></h1><pre><code class="csharp hljs"><span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">EpsicRpgDataContext</span> _context<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token function">CharacterService</span><span class="token punctuation">(</span><span class="token class-name">EpsicRpgDataContext</span> context<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    _context <span class="token operator">=</span> context<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name">IList<span class="token punctuation">&lt;</span>Character<span class="token punctuation">&gt;</span></span> <span class="token function">GetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> _context<span class="token punctuation">.</span>Characters<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr><h1 id="Logging" data-id="Logging"><a class="anchor hidden-xs" href="#Logging" title="Logging"><span class="octicon octicon-link"></span></a><span>Logging</span></h1><ul>
<li><span>EF Core peut logguer toutes les requêtes qu’il effectue en base de données dans la console.</span></li>
<li><span>Pour ce faire, il suffit d’ajouter dans le fichier </span><code>appsettings.json</code><span>, la ligne suivante dans l’objet </span><code>Logging-&gt;LogLevel</code><span> :</span></li>
</ul><pre><code>"Microsoft.EntityFrameworkCore.Database.Command": "Information"
</code></pre><pre><code class="json hljs"><span class="token punctuation">{</span>
  <span class="token property">"Logging"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"LogLevel"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"Default"</span><span class="token operator">:</span> <span class="token string">"Information"</span><span class="token punctuation">,</span>
      <span class="token property">"Microsoft"</span><span class="token operator">:</span> <span class="token string">"Warning"</span><span class="token punctuation">,</span>
      <span class="token property">"Microsoft.Hosting.Lifetime"</span><span class="token operator">:</span> <span class="token string">"Information"</span><span class="token punctuation">,</span>
      <span class="token property">"Microsoft.EntityFrameworkCore.Database.Command"</span><span class="token operator">:</span> <span class="token string">"Information"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"AllowedHosts"</span><span class="token operator">:</span> <span class="token string">"*"</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://i.imgur.com/grgnSAx.png" alt="" loading="lazy"></p><hr><h1 id="Premier-CRUD" data-id="Premier-CRUD"><a class="anchor hidden-xs" href="#Premier-CRUD" title="Premier-CRUD"><span class="octicon octicon-link"></span></a><span>Premier CRUD</span></h1><ul>
<li><code>EpsicRpgDataContext</code><span> nous permet via les </span><code>DbSet</code><span> comme </span><code>DbSet&lt;Character&gt;</code><span> d’accéder à une table de notre DB.</span></li>
<li><span>Via cette propriété on peu effectuer toutes les opérations CRUD</span></li>
<li><span>Au slide précédent nous avons retourné toute la table, mais grâce à LINQ (vu dans un précédent cours) l’on peut filtrer, grouper, ordrer, etc le contenu de la table avant de la retourner.</span></li>
<li><span>Pour les autres opération </span><mark><span>CREATE</span></mark><span>, </span><mark><span>UPDATE</span></mark><span> et </span><mark><span>DELETE</span></mark><span> c’est la même chose, on doit récupérer des éléments via le </span><mark><span>READ</span></mark><span>, les modifier et appeler </span><code>_context.SaveChanges()</code><span> pour persister les modifications en base.</span></li>
<li><span>À vous de jouer… 🏆</span></li>
</ul><hr><h1 id="Exercice-7--CRUD" data-id="Exercice-7--CRUD"><a class="anchor hidden-xs" href="#Exercice-7--CRUD" title="Exercice-7--CRUD"><span class="octicon octicon-link"></span></a><span>Exercice 7 : CRUD</span></h1><div class="alert alert-info">
<ul>
<li><span>git commit -am “finished ex6”</span></li>
<li><span>git fetch</span></li>
<li><span>git checkout ex7</span></li>
</ul>
</div><ul>
<li>
<p><span>Supprimer la liste </span><code>_characters</code><span> de </span><code>CharacterService</code></p>
</li>
<li>
<p><span>Remplacer toutes les opérations effectuées maintenant dans cette liste par des opéaration qui s’opéreront en base de données via notre </span><code>_context</code><span> EF Core.</span></p>
</li>
<li>
<p><span>Tous les test, que l’on a déjà, devraient passer à la fin de l’exercice et le comportement de l’application ne devrait pas être altéré.</span></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/blazor-server-ef-core?view=aspnetcore-3.1" target="_blank" rel="noopener"><span>Intro Microsoft</span></a></p>
</li>
<li>
<p><a href="https://www.learnentityframeworkcore.com/dbcontext/modifying-data" target="_blank" rel="noopener"><span>Learn Entity Framework Core</span></a></p>
</li>
</ul></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li><a href="#I-CH-151" title="I-CH 151">I-CH 151</a></li>
<li><a href="#Introduction" title="Introduction">Introduction</a></li>
<li><a href="#EF-Core" title="EF Core">EF Core</a></li>
<li><a href="#Code-first-vs-Database-first" title="Code first vs Database first">Code first vs Database first</a></li>
<li><a href="#Installer-EF-Core" title="Installer EF Core">Installer EF Core</a></li>
<li><a href="#DataContext" title="DataContext">DataContext</a></li>
<li><a href="#DataContext1" title="DataContext">DataContext</a></li>
<li><a href="#Setup-amp-Injection" title="Setup &amp; Injection">Setup &amp; Injection</a></li>
<li><a href="#Migrations" title="Migrations">Migrations</a></li>
<li><a href="#Première-migration" title="Première migration">Première migration</a></li>
<li><a href="#Première-migration1" title="Première migration">Première migration</a><ul class="nav">
<li><a href="#20201129201557_InitialCreatecs" title="20201129201557_InitialCreate.cs">20201129201557_InitialCreate.cs</a></li>
</ul>
</li>
<li><a href="#Première-DB" title="Première DB">Première DB</a></li>
<li><a href="#Première-requête" title="Première requête">Première requête</a></li>
<li><a href="#Première-requête1" title="Première requête">Première requête</a></li>
<li><a href="#Logging" title="Logging">Logging</a></li>
<li><a href="#Premier-CRUD" title="Premier CRUD">Premier CRUD</a></li>
<li><a href="#Exercice-7--CRUD" title="Exercice 7 : CRUD">Exercice 7 : CRUD</a></li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        <div class="toc"><ul class="nav">
<li><a href="#I-CH-151" title="I-CH 151">I-CH 151</a></li>
<li><a href="#Introduction" title="Introduction">Introduction</a></li>
<li><a href="#EF-Core" title="EF Core">EF Core</a></li>
<li><a href="#Code-first-vs-Database-first" title="Code first vs Database first">Code first vs Database first</a></li>
<li><a href="#Installer-EF-Core" title="Installer EF Core">Installer EF Core</a></li>
<li><a href="#DataContext" title="DataContext">DataContext</a></li>
<li><a href="#DataContext1" title="DataContext">DataContext</a></li>
<li><a href="#Setup-amp-Injection" title="Setup &amp; Injection">Setup &amp; Injection</a></li>
<li><a href="#Migrations" title="Migrations">Migrations</a></li>
<li><a href="#Première-migration" title="Première migration">Première migration</a></li>
<li><a href="#Première-migration1" title="Première migration">Première migration</a><ul class="nav">
<li><a href="#20201129201557_InitialCreatecs" title="20201129201557_InitialCreate.cs">20201129201557_InitialCreate.cs</a></li>
</ul>
</li>
<li><a href="#Première-DB" title="Première DB">Première DB</a></li>
<li><a href="#Première-requête" title="Première requête">Première requête</a></li>
<li><a href="#Première-requête1" title="Première requête">Première requête</a></li>
<li><a href="#Logging" title="Logging">Logging</a></li>
<li><a href="#Premier-CRUD" title="Premier CRUD">Premier CRUD</a></li>
<li><a href="#Exercice-7--CRUD" title="Exercice 7 : CRUD">Exercice 7 : CRUD</a></li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
